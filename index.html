<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MarketPro PWA Standalone</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#16a34a">
<style>
body{margin:0;font-family:Arial;background:#0f172a;color:white;text-align:center}
button{padding:10px 18px;margin:5px;border:none;border-radius:8px;background:#16a34a;color:white;cursor:pointer}
.card{background:white;color:#0f172a;padding:15px;border-radius:10px;margin:10px auto;max-width:350px}
h2{margin-top:40px}
</style>
</head>
<body>

<h1>MarketPro PWA</h1>
<p>Versi Tanpa Server - 100% Offline Ready</p>

<h2>Produk</h2>
<div id="productList"></div>

<h2>Keranjang</h2>
<div id="cartList"></div>
<button onclick="checkout()">Checkout</button>

<h2>Invoice</h2>
<div id="invoiceList"></div>

<script>
const products=[
{id:1,name:"Produk A",price:10000},
{id:2,name:"Produk B",price:20000},
{id:3,name:"Produk C",price:30000}
];

let cart=JSON.parse(localStorage.getItem("cart"))||[];
let invoices=JSON.parse(localStorage.getItem("invoices"))||[];

function saveData(){
localStorage.setItem("cart",JSON.stringify(cart));
localStorage.setItem("invoices",JSON.stringify(invoices));
}

function renderProducts(){
const c=document.getElementById("productList");
c.innerHTML="";
products.forEach(p=>{
c.innerHTML+=`<div class="card">
<b>${p.name}</b><br>Rp ${p.price}<br>
<button onclick="addToCart(${p.id})">Tambah</button>
</div>`;
});
}

function addToCart(id){
const item=products.find(p=>p.id===id);
cart.push(item);
saveData();
renderCart();
alert("Ditambahkan ke keranjang");
}

function renderCart(){
const c=document.getElementById("cartList");
c.innerHTML="";
if(cart.length===0){c.innerHTML="<p>Kosong</p>";return;}
cart.forEach(i=>{
c.innerHTML+=`<div class="card">${i.name} - Rp ${i.price}</div>`;
});
}

function checkout(){
if(cart.length===0){alert("Keranjang kosong");return;}
let total=cart.reduce((sum,i)=>sum+i.price,0);
let invoice={
id:Date.now(),
number:"INV-"+Date.now(),
total:total,
status:"pending",
date:new Date().toLocaleString()
};
invoices.push(invoice);
cart=[];
saveData();
renderCart();
renderInvoices();
alert("Order dibuat & Invoice generated");
}

function renderInvoices(){
const c=document.getElementById("invoiceList");
c.innerHTML="";
if(invoices.length===0){c.innerHTML="<p>Belum ada invoice</p>";return;}
invoices.forEach(inv=>{
c.innerHTML+=`<div class="card">
Invoice: ${inv.number}<br>
Tanggal: ${inv.date}<br>
Total: Rp ${inv.total}<br>
Status: ${inv.status}<br>
<button onclick="payInvoice(${inv.id})">Konfirmasi Bayar</button>
</div>`;
});
}

function payInvoice(id){
let inv=invoices.find(i=>i.id===id);
inv.status="paid";
saveData();
renderInvoices();
alert("Pembayaran dikonfirmasi");
}

renderProducts();
renderCart();
renderInvoices();

if('serviceWorker' in navigator){
navigator.serviceWorker.register('sw.js');
}
</script>

</body>
</html>
